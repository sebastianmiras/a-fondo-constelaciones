
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Constelación — Alejo Carpentier</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #graph { width: 100%; height: 100vh; }
    .legend {
      position: fixed; right: 16px; bottom: 16px;
      background: rgba(255,255,255,.92);
      border: 1px solid #e5e7eb; border-radius: 12px;
      padding: 10px 12px; font-size: 13px; backdrop-filter: saturate(180%) blur(8px);
      z-index: 1000;
    }
    .tooltip {
      position: fixed; pointer-events: none; z-index: 2000;
      background: rgba(0,0,0,.85); color: #fff; padding: 8px 10px; border-radius: 8px; font-size: 12px; max-width: 420px;
      transform: translate(12px, 12px);
    }
    .pill { display:inline-block; padding:2px 6px; border-radius:999px; font-size:11px; margin-left:6px; background:#f3f4f6; }
    .controlbar {
      position: fixed; left: 16px; top: 16px;
      background: rgba(255,255,255,.92);
      border: 1px solid #e5e7eb; border-radius: 12px;
      padding: 10px 12px; font-size: 13px; backdrop-filter: saturate(180%) blur(8px);
      z-index:1000;
      display:flex; gap:8px; align-items:center;
    }
    select, input[type="search"] {
      border: 1px solid #e5e7eb; border-radius: 8px; padding: 6px 8px; font-size: 13px;
    }
    button { border:1px solid #e5e7eb; border-radius:8px; padding:6px 10px; background:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <div class="controlbar">
    <label for="catSel">Categoría:</label>
    <select id="catSel"></select>
    <label for="subSel">Subcategoría:</label>
    <select id="subSel"></select>
    <input id="searchBox" type="search" placeholder="Buscar referencia…" />
    <button id="resetBtn">Reiniciar</button>
  </div>
  <svg id="graph"></svg>

  <div class="legend">
    <b>Leyenda</b><br>
    <div style="margin-top:6px">
      <div><span style="display:inline-block;width:10px;height:10px;background:#EF4444;border-radius:50%;margin-right:6px"></span>A. Personales y biográficas</div>
      <div><span style="display:inline-block;width:10px;height:10px;background:#3B82F6;border-radius:50%;margin-right:6px"></span>B. Culturales y artísticas</div>
      <div><span style="display:inline-block;width:10px;height:10px;background:#10B981;border-radius:50%;margin-right:6px"></span>C. Pensamiento y conocimiento</div>
      <div><span style="display:inline-block;width:10px;height:10px;background:#F59E0B;border-radius:50%;margin-right:6px"></span>D. Contexto sociohistórico</div>
    </div>
    <div style="margin-top:6px;opacity:.9">Formas → Subcategorías</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script>
    const data = {"nodes": [{"id": "contexto_sociohistorico", "label": "Contexto sociohistórico", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 8}, {"id": "referencias_culturales_y_artisticas", "label": "Referencias culturales y artísticas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 9}, {"id": "referencias_de_pensamiento_y_conocimiento", "label": "Referencias de pensamiento y conocimiento", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 8}, {"id": "referencias_personales_y_biograficas", "label": "Referencias personales y biográficas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 8}, {"id": "audiovisuales_y_cinematograficas", "label": "Audiovisuales y cinematográficas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 8}, {"id": "biograficas", "label": "Biográficas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 16}, {"id": "cientificas_y_academicas", "label": "Científicas y académicas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 17}, {"id": "eventos_y_congresos", "label": "Eventos y congresos", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 9}, {"id": "filosoficas_y_religiosas", "label": "Filosóficas y religiosas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 8}, {"id": "geograficas", "label": "Geográficas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 24}, {"id": "literarias", "label": "Literarias", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 24}, {"id": "musicales", "label": "Musicales", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 10}, {"id": "personales_redes", "label": "Personales (redes)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 14}, {"id": "alejo_carpentier_entrevistado", "label": "Alejo Carpentier (entrevistado)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "nacimiento_26_de_diciembre_de_1904_la_habana", "label": "Nacimiento: 26 de diciembre de 1904 (La Habana)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "infancia_en_finca_rural_provincia_de_la_habana", "label": "Infancia en finca rural (provincia de La Habana)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "padre_arquitecto_frances", "label": "Padre arquitecto francés", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "madre_rusa_estudios_en_suiza", "label": "Madre rusa (estudios en Suiza)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "bilingue_espanol_frances_educacion_en_casa", "label": "Bilingüe español/francés (educación en casa)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "prision_politica_en_la_habana_1927", "label": "Prisión política en La Habana (1927)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "exilio_en_paris_llega_1928", "label": "Exilio en París (llega 1928)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "embajador_de_cuba_fallece_en_paris", "label": "Embajador de Cuba (fallece en París)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "esposa_lilia_matrimonio_1941", "label": "Esposa Lilia (matrimonio 1941)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "concierto_barroco", "label": "Concierto barroco", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "ecueyambao", "label": "Ecueyambao", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "viaje_a_la_semilla", "label": "Viaje a la semilla", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "la_guerra_del_tiempo", "label": "La guerra del tiempo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "el_reino_de_este_mundo", "label": "El reino de este mundo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "los_pasos_perdidos", "label": "Los pasos perdidos", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "el_acoso", "label": "El acoso", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "el_siglo_de_las_luces", "label": "El siglo de las luces", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "carteles_revista_cubana", "label": "Carteles (revista cubana)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "cruz_y_raya_revista", "label": "Cruz y Raya (revista)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "pombo_tertulia_cafe", "label": "Pombo (tertulia / café)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "la_granja_del_henar_cafe", "label": "La Granja del Henar (café)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "cerveceria_de_correos_madrid", "label": "Cervecería de Correos (Madrid)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "radio_luxemburgo", "label": "Radio Luxemburgo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "unesco", "label": "UNESCO", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "federico_garcia_lorca", "label": "Federico García Lorca", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "herrera_petere", "label": "Herrera Petere", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "jose_bergamin", "label": "José Bergamín", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "montesinos_intelectual_del_circulo", "label": "Montesinos (intelectual del círculo)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "eugenio_d_ors_posible_correccion_de_eugenio_imas", "label": "Eugenio d'Ors (posible corrección de 'Eugenio Imás')", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "ramon_del_valle_inclan", "label": "Ramón del Valle‑Inclán", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "manuel_bueno_critico", "label": "Manuel Bueno (crítico)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "azorin", "label": "Azorín", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "pio_baroja", "label": "Pío Baroja", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "miguel_de_unamuno", "label": "Miguel de Unamuno", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "ultraismo", "label": "Ultraísmo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "rafael_barradas", "label": "Rafael Barradas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "guillermo_de_torre", "label": "Guillermo de Torre", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "rafael_alberti", "label": "Rafael Alberti", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "miguel_de_cervantes_don_quijote_de_la_mancha", "label": "Miguel de Cervantes — Don Quijote de la Mancha", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "homero_odisea_ulises", "label": "Homero — Odisea / Ulises", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "dante_alighieri_divina_comedia", "label": "Dante Alighieri — Divina Comedia", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "johann_wolfgang_von_goethe_fausto", "label": "Johann Wolfgang von Goethe — Fausto", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "rabelais_fran_ois", "label": "Rabelais (François)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "stendhal", "label": "Stendhal", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "marcel_proust", "label": "Marcel Proust", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "laurence_sterne_tristram_shandy", "label": "Laurence Sterne — Tristram Shandy", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "diego_de_torres_villarroel_vida", "label": "Diego de Torres Villarroel — Vida", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "lazarillo_de_tormes", "label": "Lazarillo de Tormes", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "homero", "label": "Homero", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "ricardo_guiraldes_don_segundo_sombra_alusivo", "label": "Ricardo Güiraldes — Don Segundo Sombra (alusivo)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "jose_eustasio_rivera_la_voragine_infierno_verde_caucheros", "label": "José Eustasio Rivera — La vorágine (infierno verde/caucheros)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "romulo_gallegos_canaima", "label": "Rómulo Gallegos — Canaima", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "miguel_angel_asturias", "label": "Miguel Ángel Asturias", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "gabriel_garcia_marquez_cien_anos_de_soledad_el_otono_del_patriarca_alusiones", "label": "Gabriel García Márquez — Cien años de soledad / El otoño del patriarca (alusiones)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "nicolas_guillen_poesia", "label": "Nicolás Guillén (poesía)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "jose_lezama_lima", "label": "José Lezama Lima", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "onelio_jorge_cardoso_cuentos", "label": "Onelio Jorge Cardoso (cuentos)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "julio_antonio_mella", "label": "Julio Antonio Mella", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "carlos_balino", "label": "Carlos Baliño", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "juan_marinello", "label": "Juan Marinello", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "jose_carlos_mariategui_amauta", "label": "José Carlos Mariátegui — Amauta", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "diego_rivera", "label": "Diego Rivera", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "jose_clemente_orozco", "label": "José Clemente Orozco", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "louis_althusser_continente_de_la_historia_economia", "label": "Louis Althusser (continente de la historia/economía)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "galileo_galilei", "label": "Galileo Galilei", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "karl_marx_continente_de_la_economia", "label": "Karl Marx (continente de la economía)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "emile_zola", "label": "Émile Zola", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "victor_hugo", "label": "Víctor Hugo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "heraclito_el_agua_de_heraclito", "label": "Heráclito (el agua de Heráclito)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "ralph_waldo_emerson", "label": "Ralph Waldo Emerson", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "walt_whitman", "label": "Walt Whitman", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "henry_david_thoreau", "label": "Henry David Thoreau", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "william_faulkner", "label": "William Faulkner", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "quetzalcoatl_serpiente_emplumada", "label": "Quetzalcóatl (serpiente emplumada)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "pablo_casals_violonchelista", "label": "Pablo Casals (violonchelista)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "amadeo_roldan_compositor", "label": "Amadeo Roldán (compositor)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "krzysztof_penderecki_opera_sobre_comedias_barbaras", "label": "Krzysztof Penderecki (ópera sobre Comedias bárbaras)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "louis_jouvet_actor_director_de_teatro", "label": "Louis Jouvet (actor/director de teatro)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "la_habana", "label": "La Habana", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "madrid", "label": "Madrid", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "paris", "label": "París", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "caracas", "label": "Caracas", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "venezuela", "label": "Venezuela", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "espana", "label": "España", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "cuba", "label": "Cuba", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "mexico_pais", "label": "México (país)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "nueva_york", "label": "Nueva York", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "tampa_ee_uu", "label": "Tampa (EE. UU.)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "guadalupe_isla", "label": "Guadalupe (isla)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "haiti", "label": "Haití", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "gran_sabana_venezuela", "label": "Gran Sabana (Venezuela)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "orinoco_rio", "label": "Orinoco (río)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "mitla_mexico", "label": "Mitla (México)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "oaxaca_mexico_templo_de_santo_domingo", "label": "Oaxaca (México) — Templo de Santo Domingo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "oaxaca_santo_domingo_templo_iglesia", "label": "Oaxaca — Santo Domingo (templo/iglesia)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "grupo_minorista_cuba_1923_1928", "label": "Grupo minorista (Cuba, 1923‑1928)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "dictadura_de_gerardo_machado_cuba", "label": "Dictadura de Gerardo Machado (Cuba)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "lucas_fernandez_pena_fundador_de_ciudades", "label": "Lucas Fernández Peña (fundador de ciudades)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "padre_bombeckio_capuchino", "label": "Padre Bombeckio (capuchino)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "mariano_brull_poeta", "label": "Mariano Brull (poeta)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "alfonso_reyes", "label": "Alfonso Reyes", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "robert_desnos", "label": "Robert Desnos", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "andre_breton", "label": "André Breton", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "lo_real_maravilloso", "label": "Lo real maravilloso", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "barroco_estetica", "label": "Barroco (estética)", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "novela_epica_latinoamericana", "label": "Novela épica latinoamericana", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "picaresca_espanola", "label": "Picaresca española", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}, {"id": "surrealismo", "label": "Surrealismo", "categoria": "Sin categoría", "subcategoria": "", "entrevistado": "", "fecha": "", "contexto": "", "color": "#6B7280", "shape": "circle", "size": 7}], "edges": [{"source": "alejo_carpentier_entrevistado", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "biograficas", "target": "referencias_personales_y_biograficas", "title": "part_of", "weight": 1.0}, {"source": "nacimiento_26_de_diciembre_de_1904_la_habana", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "infancia_en_finca_rural_provincia_de_la_habana", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "padre_arquitecto_frances", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "madre_rusa_estudios_en_suiza", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "bilingue_espanol_frances_educacion_en_casa", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "prision_politica_en_la_habana_1927", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "exilio_en_paris_llega_1928", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "embajador_de_cuba_fallece_en_paris", "target": "biograficas", "title": "belongs_to", "weight": 1.0}, {"source": "esposa_lilia_matrimonio_1941", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "personales_redes", "target": "referencias_personales_y_biograficas", "title": "part_of", "weight": 1.0}, {"source": "concierto_barroco", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "literarias", "target": "referencias_culturales_y_artisticas", "title": "part_of", "weight": 1.0}, {"source": "ecueyambao", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "viaje_a_la_semilla", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "la_guerra_del_tiempo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "el_reino_de_este_mundo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "los_pasos_perdidos", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "el_acoso", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "el_siglo_de_las_luces", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "carteles_revista_cubana", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "cruz_y_raya_revista", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "pombo_tertulia_cafe", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "la_granja_del_henar_cafe", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "cerveceria_de_correos_madrid", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "radio_luxemburgo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "unesco", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "federico_garcia_lorca", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "herrera_petere", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "jose_bergamin", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "montesinos_intelectual_del_circulo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "eugenio_d_ors_posible_correccion_de_eugenio_imas", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "ramon_del_valle_inclan", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "manuel_bueno_critico", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "azorin", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "pio_baroja", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "miguel_de_unamuno", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "ultraismo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "rafael_barradas", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "guillermo_de_torre", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "rafael_alberti", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "miguel_de_cervantes_don_quijote_de_la_mancha", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "homero_odisea_ulises", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "dante_alighieri_divina_comedia", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "johann_wolfgang_von_goethe_fausto", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "rabelais_fran_ois", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "stendhal", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "marcel_proust", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "laurence_sterne_tristram_shandy", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "diego_de_torres_villarroel_vida", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "lazarillo_de_tormes", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "homero", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "ricardo_guiraldes_don_segundo_sombra_alusivo", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "jose_eustasio_rivera_la_voragine_infierno_verde_caucheros", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "romulo_gallegos_canaima", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "miguel_angel_asturias", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "gabriel_garcia_marquez_cien_anos_de_soledad_el_otono_del_patriarca_alusiones", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "nicolas_guillen_poesia", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "jose_lezama_lima", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "onelio_jorge_cardoso_cuentos", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "julio_antonio_mella", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "carlos_balino", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "juan_marinello", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "jose_carlos_mariategui_amauta", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "diego_rivera", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "jose_clemente_orozco", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "louis_althusser_continente_de_la_historia_economia", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "cientificas_y_academicas", "target": "referencias_de_pensamiento_y_conocimiento", "title": "part_of", "weight": 1.0}, {"source": "galileo_galilei", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "karl_marx_continente_de_la_economia", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "emile_zola", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "victor_hugo", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "heraclito_el_agua_de_heraclito", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "ralph_waldo_emerson", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "walt_whitman", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "henry_david_thoreau", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "william_faulkner", "target": "cientificas_y_academicas", "title": "belongs_to", "weight": 1.0}, {"source": "quetzalcoatl_serpiente_emplumada", "target": "filosoficas_y_religiosas", "title": "belongs_to", "weight": 1.0}, {"source": "filosoficas_y_religiosas", "target": "referencias_de_pensamiento_y_conocimiento", "title": "part_of", "weight": 1.0}, {"source": "pablo_casals_violonchelista", "target": "musicales", "title": "belongs_to", "weight": 1.0}, {"source": "musicales", "target": "referencias_culturales_y_artisticas", "title": "part_of", "weight": 1.0}, {"source": "amadeo_roldan_compositor", "target": "musicales", "title": "belongs_to", "weight": 1.0}, {"source": "krzysztof_penderecki_opera_sobre_comedias_barbaras", "target": "musicales", "title": "belongs_to", "weight": 1.0}, {"source": "louis_jouvet_actor_director_de_teatro", "target": "audiovisuales_y_cinematograficas", "title": "belongs_to", "weight": 1.0}, {"source": "audiovisuales_y_cinematograficas", "target": "referencias_culturales_y_artisticas", "title": "part_of", "weight": 1.0}, {"source": "la_habana", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "geograficas", "target": "contexto_sociohistorico", "title": "part_of", "weight": 1.0}, {"source": "madrid", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "paris", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "caracas", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "venezuela", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "espana", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "cuba", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "mexico_pais", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "nueva_york", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "tampa_ee_uu", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "guadalupe_isla", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "haiti", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "gran_sabana_venezuela", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "orinoco_rio", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "mitla_mexico", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "oaxaca_mexico_templo_de_santo_domingo", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "oaxaca_santo_domingo_templo_iglesia", "target": "geograficas", "title": "belongs_to", "weight": 1.0}, {"source": "grupo_minorista_cuba_1923_1928", "target": "eventos_y_congresos", "title": "belongs_to", "weight": 1.0}, {"source": "eventos_y_congresos", "target": "contexto_sociohistorico", "title": "part_of", "weight": 1.0}, {"source": "dictadura_de_gerardo_machado_cuba", "target": "eventos_y_congresos", "title": "belongs_to", "weight": 1.0}, {"source": "lucas_fernandez_pena_fundador_de_ciudades", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "padre_bombeckio_capuchino", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "mariano_brull_poeta", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "alfonso_reyes", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "robert_desnos", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "andre_breton", "target": "personales_redes", "title": "belongs_to", "weight": 1.0}, {"source": "lo_real_maravilloso", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "barroco_estetica", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "novela_epica_latinoamericana", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "picaresca_espanola", "target": "literarias", "title": "belongs_to", "weight": 1.0}, {"source": "surrealismo", "target": "literarias", "title": "belongs_to", "weight": 1.0}]};

    const width = window.innerWidth, height = window.innerHeight;
    const svg = d3.select("#graph").attr("width", width).attr("height", height);
    const g = svg.append("g");

    const zoom = d3.zoom().scaleExtent([0.2, 4]).on("zoom", (event) => {
      g.attr("transform", event.transform);
    });
    svg.call(zoom);

    // Arrowheads (optional for directed look; edges are undirected here)
    svg.append("defs").append("marker")
      .attr("id", "arrow").attr("viewBox", "0 -5 10 10")
      .attr("refX", 15).attr("refY", 0)
      .attr("markerWidth", 6).attr("markerHeight", 6).attr("orient", "auto")
      .append("path").attr("d", "M0,-5L10,0L0,5").attr("fill", "#9ca3af");

    // Filters
    const catSel = document.getElementById("catSel");
    const subSel = document.getElementById("subSel");
    const searchBox = document.getElementById("searchBox");
    const resetBtn = document.getElementById("resetBtn");

    const unique = (arr) => Array.from(new Set(arr.filter(Boolean))).sort();
    const categories = ["(todas)", ...unique(data.nodes.map(n => n.categoria))];
    categories.forEach(c => {
      const opt = document.createElement("option"); opt.value = c; opt.textContent = c; catSel.appendChild(opt);
    });
    const allSubcats = ["(todas)", ...unique(data.nodes.map(n => n.subcategoria))];
    allSubcats.forEach(s => {
      const opt = document.createElement("option"); opt.value = s; opt.textContent = s; subSel.appendChild(opt);
    });

    function nodeShape(d) {
      switch ((d.shape || "circle")) {
        case "square": return d3.symbolSquare;
        case "triangle": return d3.symbolTriangle;
        case "triangle-down": return d3.symbolTriangle;
        case "diamond": return d3.symbolDiamond;
        case "star": return d3.symbolStar;
        case "hexagon": return d3.symbolWye; // closest built-in
        default: return d3.symbolCircle;
      }
    }

    // Build graph elements
    const link = g.append("g").attr("stroke", "#9ca3af").attr("stroke-opacity", 0.6)
      .selectAll("line").data(data.edges).join("line")
      .attr("stroke-width", d => Math.max(1, Math.min(6, (d.weight || 1))));

    const node = g.append("g").selectAll("path").data(data.nodes).join("path")
      .attr("d", d3.symbol().type(d => nodeShape(d)).size(d => (d.size || 8) * 10))
      .attr("fill", d => d.color || "#6b7280")
      .attr("stroke", "#111827").attr("stroke-width", 0.5)
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

    const label = g.append("g").attr("font-size", 11).attr("font-family", "inherit")
      .selectAll("text").data(data.nodes).join("text")
      .attr("dy", "-0.8em")
      .attr("stroke", "white").attr("stroke-width", 3).attr("paint-order", "stroke")
      .text(d => d.label);

    // Tooltip
    const tooltip = d3.select("body").append("div").attr("class", "tooltip").style("display","none");
    function showTooltip(event, d) {
      let html = `<b>${d.label}</b>`;
      html += ` <span class="pill">${d.categoria || ""}${d.subcategoria ? " · " + d.subcategoria : ""}</span>`;
      if (d.entrevistado) html += `<div>Entrevistado: ${d.entrevistado}</div>`;
      if (d.fecha) html += `<div>Fecha: ${d.fecha}</div>`;
      if (d.contexto) html += `<div style="margin-top:6px;opacity:.9">${d.contexto.length > 500 ? d.contexto.slice(0,497)+'…' : d.contexto}</div>`;
      tooltip.html(html).style("display","block").style("left", (event.pageX+12)+"px").style("top", (event.pageY+12)+"px");
    }
    function hideTooltip(){ tooltip.style("display","none"); }

    node.on("mousemove", (event,d)=> showTooltip(event,d)).on("mouseout", hideTooltip);
    label.on("mousemove", (event,d)=> showTooltip(event,d)).on("mouseout", hideTooltip);

    const sim = d3.forceSimulation(data.nodes)
      .force("link", d3.forceLink(data.edges).id(d => d.id).distance(d => 60 + 10*(d.weight||1)).strength(0.05))
      .force("charge", d3.forceManyBody().strength(-120))
      .force("center", d3.forceCenter(width/2, height/2))
      .force("collision", d3.forceCollide().radius(d => (d.size||8) + 6));

    sim.on("tick", () => {
      link.attr("x1", d => d.source.x)
          .attr("y1", d => d.source.y)
          .attr("x2", d => d.target.x)
          .attr("y2", d => d.target.y);
      node.attr("transform", d => `translate(${d.x},${d.y})`);
      label.attr("x", d => d.x).attr("y", d => d.y);
    });

    function dragstarted(event) {
      if (!event.active) sim.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }
    function dragged(event) {
      event.subject.fx = event.x;
      event.subject.fy = event.y;
    }
    function dragended(event) {
      if (!event.active) sim.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
    }

    // Filtering + search
    function applyFilters() {
      const cat = catSel.value;
      const sub = subSel.value;
      const q = searchBox.value.trim().toLowerCase();

      const visible = new Set();
      data.nodes.forEach(n => {
        let ok = true;
        if (cat && cat !== "(todas)") ok = ok && (n.categoria === cat);
        if (sub && sub !== "(todas)") ok = ok && (n.subcategoria === sub);
        if (q) ok = ok && ((n.label||"").toLowerCase().includes(q) || (n.contexto||"").toLowerCase().includes(q));
        if (ok) visible.add(n.id);
      });

      // hide/show nodes and edges
      node.attr("display", d => visible.has(d.id) ? null : "none");
      label.attr("display", d => visible.has(d.id) ? null : "none");
      link.attr("display", d => (visible.has(d.source.id) && visible.has(d.target.id)) ? null : "none");
    }
    catSel.addEventListener("change", applyFilters);
    subSel.addEventListener("change", applyFilters);
    searchBox.addEventListener("input", applyFilters);
    resetBtn.addEventListener("click", () => {
      catSel.value="(todas)"; subSel.value="(todas)"; searchBox.value=""; applyFilters();
    });

    // Fit to screen on load
    setTimeout(()=>{
      const bounds = g.node().getBBox();
      const fullWidth = bounds.width, fullHeight = bounds.height;
      const midX = bounds.x + fullWidth / 2, midY = bounds.y + fullHeight / 2;
      const scale = 0.85 / Math.max(fullWidth / width, fullHeight / height);
      const translate = [width / 2 - scale * midX, height / 2 - scale * midY];
      svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale));
    }, 900);
  </script>

  <script>
    // simple resize
    window.addEventListener("resize", () => {
      const svg = document.getElementById("graph");
      svg.setAttribute("width", window.innerWidth);
      svg.setAttribute("height", window.innerHeight);
    });
  </script>
</body>
</html>
