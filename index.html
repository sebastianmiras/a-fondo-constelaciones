<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Constelaciones — Galería de entrevistas</title>
  <meta name="description" content="Galería de rostros; cada imagen abre la constelación correspondiente.">
  <style>
    :root{--bg:#fff;--fg:#111827;--muted:#6b7280;--border:#e5e7eb;--accent:#2563eb}
    html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{padding:24px 16px;border-bottom:1px solid var(--border)}
    header .wrap, main .wrap{max-width:1100px;margin:0 auto}
    h1{margin:0;font-size:28px}
    p{color:var(--muted);margin:6px 0 0}
    .toolbar{display:flex;gap:8px;align-items:center;margin-top:12px}
    input[type="search"]{border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;width:320px;max-width:100%}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px;padding:18px 0 40px}
    .card{display:flex;flex-direction:column;align-items:center;gap:10px;text-align:center}
    .face{width:160px;height:160px;border-radius:50%;border:2px solid var(--border);overflow:hidden;background:#f3f4f6;display:flex;align-items:center;justify-content:center}
    .face img{width:100%;height:100%;object-fit:cover;display:block}
    .name{font-weight:600}
    .tags{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}
    .tag{background:#eef2ff;border:1px solid #c7d2fe;color:#3730a3;border-radius:999px;padding:2px 8px;font-size:12px}
    a.cardlink{color:inherit;text-decoration:none}
    a.cardlink:hover .name{color:var(--accent);text-decoration:underline}
    footer{border-top:1px solid var(--border);padding:18px 16px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Galería de entrevistas</h1>
      <p>Pulsa en el rostro para abrir la constelación.</p>
      <div class="toolbar">
        <input id="q" type="search" placeholder="Buscar por nombre o etiqueta…">
      </div>
    </div>
  </header>
  <main>
    <div class="wrap">
      <div id="grid" class="grid"></div>
    </div>
  </main>
  <footer>
    <div class="wrap">A fondo — constelaciones interactivas</div>
  </footer>

  <script>
    const state = { items: [] };

    function render(list){
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      if (!list.length){
        grid.innerHTML = "<p>No hay resultados.</p>";
        return;
      }
      list.forEach(it => {
        const a = document.createElement("a");
        a.href = it.file;
        a.target = "_blank";
        a.rel = "noopener";
        a.className = "cardlink";
        const card = document.createElement("div");
        card.className = "card";

        const face = document.createElement("div");
        face.className = "face";
        const img = document.createElement("img");
        img.loading = "lazy";
        img.alt = it.title || it.id;
        img.src = it.thumb || "img/carpentier_placeholder.svg"; // placeholder if missing
        face.appendChild(img);

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = (it.title || it.id || "").replace(/ — Constelación.*/,"");

        const tags = document.createElement("div");
        tags.className = "tags";
        (it.tags||[]).forEach(t => {
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = t;
          tags.appendChild(span);
        });

        card.appendChild(face);
        card.appendChild(name);
        if ((it.tags||[]).length) card.appendChild(tags);
        a.appendChild(card);
        grid.appendChild(a);
      });
    }

    function applySearch(){
      const q = document.getElementById("q").value.trim().toLowerCase();
      const filtered = state.items.filter(it => {
        const hay = (it.title||"") + " " + (it.tags||[]).join(" ");
        return hay.toLowerCase().includes(q);
      });
      render(filtered);
    }

    fetch("manifest.json").then(r => r.json()).then(items => {
      state.items = items;
      render(items);
      document.getElementById("q").addEventListener("input", applySearch);
    }).catch(err => {
      document.getElementById("grid").innerHTML = "<p>Error cargando manifest.json.</p>";
      console.error(err);
    });
  </script>
</body>
</html>
